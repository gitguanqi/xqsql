const add=(e,t,l)=>{let n="",$=[],o="",i="`"+e+"`";for(let e=0;e<l.length;e++){let t=l[e];n+=t.value+","}for(const e of t){let t="";for(const n of l){let l=e[n.value];l="number"==typeof l?parseInt(l):`"${l}"`,t+=l+","}t=t.slice(0,t.length-1),$.push(`(0,${t})`)}return n=n.slice(0,n.length-1),$=$.join(","),o=`INSERT INTO ${i} (id, ${n}) VALUES ${$}`,o},get=(e,t,l="default",n="*")=>{let $="",o="",i="",s="`"+e+"`",E=`SELECT ${n} FROM ${s}`,r=`SELECT COUNT(id) FROM ${s}`,a=["name","user","origin_name","url"];if("default"===l){let e={},l=t.key,n="one"===t.type?t.ids[0]:"more"===t.type?t.ids.join(","):"",o=t.type;e.one=`${E} WHERE ${l} = '${n}'`,e.more=`${E} WHERE ${l} in (${n})`,e.all=E,$=e[o]}if("more"===l){let e="";for(const l in t){let n=t[l];n="number"==typeof n?parseInt(n):n,"string"==typeof n&&(n=n.replace(/\"/g,"")),(n||0==n)&&(a.includes(l)?e+=` ${l} LIKE '%${n}%' AND`:e+=` ${l} = '${n}' AND`)}e=e.slice(0,e.length-4),$=`${E} WHERE ${e}`}if("page"===l){let e="",l="";if(t.list){for(const l in t.list){let n=t.list[l];n="number"==typeof n?parseInt(n):n,n&&(a.includes(l)?e+=` ${l} LIKE '%${n}%' AND`:e+=` ${l} = '${n}' AND`),0===n&&(e+=` ${l} = 0 AND`)}e=e.slice(0,e.length-4)}e=""!==e?`WHERE ${e}`:"",l=`ORDER by ${t.sorts.name} ${t.sorts.val} LIMIT ${t.limits.page},${t.limits.size}`,$=`${E} ${e} ${l}`,o=`${r} ${e}`}return i="page"===l?{sql:$,count:o}:$,i},up=(e,t,l,n="one")=>{let $=t.key,o=t.ids,i=t.list,s=o&&o.length<=1?o[0]:o.join(","),E="",r="`"+e+"`";for(const e of l){let t=e.value,l=i[e.value];if(t in i&&""===l&&e.isMust)return res.json({code:101,msg:"save_fail",data:{info:`请填写${e.name}!`}});t in i&&null!==l&&(l="number"==typeof l?parseInt(l):`"${l}"`,E+=`${t} = ${l},`)}E=E.slice(0,E.length-1);let a={one:`UPDATE ${r} SET ${E} WHERE ${$} = '${s}'`,more:`UPDATE ${r} SET ${E} WHERE ${$} in (${s})`,all:`UPDATE ${r} SET ${E}`};return a[n]},del=(e,t,l="one")=>{let n=t.key,$=t.ids,o="one"==l?$[0]:"more"==l?$.join(","):"",i="`"+e+"`",s={one:`DELETE FROM ${i} WHERE ${n} = '${o}'`,more:`DELETE FROM ${i} WHERE ${n} in (${o})`,all:`DELETE FROM ${i}`};return s[l]},xqsql={add:add,get:get,up:up,del:del};export default xqsql;