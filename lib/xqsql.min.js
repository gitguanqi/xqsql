(function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t()):"function"==typeof define&&define.cmd?define(function(e,n,o){o.exports=t()}):e.xqsql=t()})(this,function(){const e=(e,t,n)=>{let o="",l=[],i="",$="`"+e+"`";for(let e=0;e<n.length;e++){let t=n[e];o+=t.value+","}for(const e of t){let t="";for(const o of n){let n=e[o.value];n="number"==typeof n?parseInt(n):`"${n}"`,t+=n+","}t=t.slice(0,t.length-1),l.push(`(0,${t})`)}return o=o.slice(0,o.length-1),l=l.join(","),i=`INSERT INTO ${$} (id, ${o}) VALUES ${l}`,i},t=(e,t,n="default",o="*")=>{let l="",i="",$="",s="`"+e+"`",r=`SELECT ${o} FROM ${s}`,E=`SELECT COUNT(id) FROM ${s}`,f=["name","user","origin_name","url"];if("default"===n){let e={},n=t.key,o="one"===t.type?t.ids[0]:"more"===t.type?t.ids.join(","):"",i=t.type;e.one=`${r} WHERE ${n} = '${o}'`,e.more=`${r} WHERE ${n} in (${o})`,e.all=r,l=e[i]}if("more"===n){let e="";for(const n in t){let o=t[n];o="number"==typeof o?parseInt(o):o,"string"==typeof o&&(o=o.replace(/\"/g,"")),(o||0==o)&&(f.includes(n)?e+=` ${n} LIKE '%${o}%' AND`:e+=` ${n} = '${o}' AND`)}e=e.slice(0,e.length-4),l=`${r} WHERE ${e}`}if("page"===n){let e="",n="";if(t.list){for(const n in t.list){let o=t.list[n];o="number"==typeof o?parseInt(o):o,o&&(f.includes(n)?e+=` ${n} LIKE '%${o}%' AND`:e+=` ${n} = '${o}' AND`),0===o&&(e+=` ${n} = 0 AND`)}e=e.slice(0,e.length-4)}e=""!==e?`WHERE ${e}`:"",n=`ORDER by ${t.sorts.name} ${t.sorts.val} LIMIT ${t.limits.page},${t.limits.size}`,l=`${r} ${e} ${n}`,i=`${E} ${e}`}return $="page"===n?{sql:l,count:i}:l,$},n=(e,t,n,o="one")=>{let l=t.key,i=t.ids,$=t.list,s=i&&i.length<=1?i[0]:i.join(","),r="",E="`"+e+"`";for(const e of n){let t=e.value,n=$[e.value];if(t in $&&""===n&&e.isMust)return res.json({code:101,msg:"save_fail",data:{info:`请填写${e.name}!`}});t in $&&null!==n&&(n="number"==typeof n?parseInt(n):`"${n}"`,r+=`${t} = ${n},`)}r=r.slice(0,r.length-1);let f={one:`UPDATE ${E} SET ${r} WHERE ${l} = '${s}'`,more:`UPDATE ${E} SET ${r} WHERE ${l} in (${s})`,all:`UPDATE ${E} SET ${r}`};return f[o]},o=(e,t,n="one")=>{let o=t.key,l=t.ids,i="one"==n?l[0]:"more"==n?l.join(","):"",$="`"+e+"`",s={one:`DELETE FROM ${$} WHERE ${o} = '${i}'`,more:`DELETE FROM ${$} WHERE ${o} in (${i})`,all:`DELETE FROM ${$}`};return s[n]};return{add:e,get:t,up:n,del:o}});